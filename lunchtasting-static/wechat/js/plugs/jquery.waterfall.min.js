!function(f){function g(b,a){this.$element=f(b),this.options=f.extend(!0,{},h,a),this.ajaxLoading=!1,this.colHeightArray=[],this._init()}var i=f(window),j="waterfall",h={itemClass:"waterfall-item",spacingWidth:10,spacingHeight:10,minColCount:2,resizeable:!1,itemAlign:"center",isFadeIn:!0,ajaxCallback:null};g.prototype={constructor:g,_init:function(){var a=this;i.on("load",function(){a._positionAll()}),this.options.resizeable&&i.on("resize",function(){a._positionAll()}),this._doScroll()},_getColumnCount:function(){var e=this.$element.width(),b=f(this.options.itemClass),d=b.eq(0).outerWidth(),a=Math.floor(e/(d+this.options.spacingWidth)),c=0,m=0;a=a>this.options.minColCount?a:this.options.minColCount,c=a*d,e>c&&(m=Math.floor((e-c-a*this.options.spacingWidth)/2)),this.itemWidth=d,this.cols=a,this.leftOffset="center"==this.options.itemAlign?m:0},_positionAll:function(){var d,b,c=this,a=f(this.options.itemClass);this._getColumnCount(),this.colHeightArray=[],a.each(function(e){f(this).css("position","absolute"),e<c.cols?(f(this).css("top",0),f(this).css("left",c.leftOffset+e*c.itemWidth+e*c.options.spacingWidth+3),c.colHeightArray.push(f(this).outerHeight())):(d=Math.min.apply(null,c.colHeightArray),b=f.inArray(d,c.colHeightArray),f(this).css("top",d+c.options.spacingHeight),f(this).css("left",a.eq(b).offset().left),c.colHeightArray[b]+=f(this).outerHeight()+c.options.spacingHeight),c.options.isFadeIn&&f(this).animate({opacity:1},300)}),this.$element.css("height",Math.max.apply(null,c.colHeightArray))},_doScroll:function(){var b,a=this;i.on("scroll",function(){b&&clearTimeout(b),b=setTimeout(function(){var d=f(a.options.itemClass).last(),c=i.scrollTop()+i.height();!a.ajaxLoading&&c>d.offset().top+d.outerHeight()/2&&(a.ajaxLoading=!0,a.options.ajaxCallback&&a.options.ajaxCallback(function(){a._positionAll()},function(){a.ajaxLoading=!1}))},100)})}},f.fn[j]=function(a){return this.each(function(){f.data(this,"plugin_"+j)||f.data(this,"plugin_"+j,new g(this,a))}),this}}(jQuery);